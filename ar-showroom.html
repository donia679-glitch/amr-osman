<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>معرض الواقع المعزز | Amr Osman Factory</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&family=Bebas+Neue&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>

    <style>
        :root {
            --gold: #D4AF37;
            --dark: #121212;
            --darker: #080808;
            --card-bg: #1e1e1e;
            --light: #f4f4f4;
            --text-gray: #a0a0a0;
            --danger: #dc3545;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Tajawal', sans-serif;
            margin: 0; padding: 0;
            background-color: var(--darker); color: var(--light);
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }

        /* الهيدر */
        header {
            background-color: var(--dark); padding: 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid var(--gold); z-index: 100;
        }
        
        /* العلامة التجارية - قابلة للضغط لتفعيل وضع المدير السري */
        .brand { display: flex; flex-direction: column; cursor: pointer; user-select: none; }
        .brand h1 { margin: 0; font-family: 'Bebas Neue', sans-serif; color: var(--gold); font-size: 26px; letter-spacing: 1px; }
        .brand p { margin: 0; font-size: 10px; color: var(--text-gray); text-transform: uppercase; letter-spacing: 1px; }

        .header-actions { display: flex; gap: 10px; }
        .btn-outline {
            background: rgba(212, 175, 55, 0.1); color: var(--gold); border: 1px solid var(--gold);
            padding: 6px 12px; border-radius: 5px; text-decoration: none; font-weight: bold; font-size: 13px; cursor: pointer; transition: 0.3s;
        }
        .btn-outline:hover { background: var(--gold); color: var(--dark); }
        .btn-danger { border-color: var(--danger); color: var(--danger); background: transparent; }
        .btn-danger:hover { background: var(--danger); color: #fff; }

        /* الأزرار المخفية للمدير */
        #adminToggleBtn, #logoutBtn { display: none; }

        /* لوحة تحكم المدير */
        .admin-panel {
            background: #111; border-bottom: 2px dashed var(--gold); padding: 15px 20px;
            display: none; flex-direction: column; gap: 10px; z-index: 90; overflow-y: auto; max-height: 40vh;
        }
        .admin-panel h3 { margin: 0; color: var(--gold); font-size: 16px; }
        .input-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .input-group input {
            flex: 1; min-width: 200px; padding: 10px; background: #222; border: 1px solid #444;
            color: #fff; border-radius: 5px; font-family: inherit; font-size: 13px;
        }
        .add-btn { background: var(--gold); color: #000; border: none; padding: 10px 20px; font-weight: bold; border-radius: 5px; cursor: pointer; }
        
        /* منطقة الـ 3D */
        .viewer-container { flex-grow: 1; position: relative; background: radial-gradient(circle at center, #2a2a2a 0%, #000 100%); display: flex; flex-direction: column; }
        model-viewer { width: 100%; height: 100%; outline: none; --poster-color: transparent; }

        .live-details { position: absolute; top: 20px; right: 20px; left: 20px; pointer-events: none; text-shadow: 0 2px 4px rgba(0,0,0,0.8); z-index: 10; }
        .live-details h2 { margin: 0 0 5px 0; color: var(--gold); font-size: 24px; font-weight: 900; }
        .live-details p { margin: 0; color: #fff; font-size: 14px; opacity: 0.9; max-width: 80%; line-height: 1.4; }

        /* الزر الإجباري لفتح الكاميرا */
        .force-ar-btn {
            background: linear-gradient(45deg, #D4AF37, #f1c40f); color: #000; border: none;
            border-radius: 50px; padding: 15px 25px; font-family: 'Tajawal', sans-serif; font-size: 16px; font-weight: 900;
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.4); cursor: pointer; display: flex; align-items: center; gap: 10px;
            white-space: nowrap; transition: 0.3s; z-index: 999;
        }
        .force-ar-btn:active { transform: translateX(-50%) scale(0.95); }

        /* منطقة المنتجات */
        .catalog-container { background: var(--dark); border-top: 1px solid #333; padding: 15px 10px; z-index: 100; }
        .catalog-title { margin: 0 10px 10px 10px; font-size: 14px; color: var(--gold); font-weight: bold; }
        .products-scroll { display: flex; gap: 15px; overflow-x: auto; padding: 5px 10px 15px 10px; scroll-behavior: smooth; }
        .products-scroll::-webkit-scrollbar { height: 6px; }
        .products-scroll::-webkit-scrollbar-track { background: #111; border-radius: 10px; }
        .products-scroll::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }

        .product-card {
            flex: 0 0 130px; background: var(--card-bg); border: 2px solid transparent;
            border-radius: 12px; overflow: hidden; cursor: pointer; transition: 0.3s; position: relative;
        }
        .product-card.active { border-color: var(--gold); box-shadow: 0 0 15px rgba(212, 175, 55, 0.3); transform: translateY(-5px); }
        .product-card img { width: 100%; height: 90px; object-fit: cover; border-bottom: 1px solid #333; background: #222; }
        .product-card .info { padding: 8px; text-align: center; }
        .product-card h3 { margin: 0 0 5px 0; font-size: 13px; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        .delete-btn { background: var(--danger); color: white; border: none; font-size: 11px; padding: 3px 6px; border-radius: 3px; cursor: pointer; width: 100%; display: none; }
        .admin-active .delete-btn { display: block; }

        /* شاشة التحميل */
        .loading-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 20; color: var(--gold); transition: opacity 0.5s; }
        .loading-overlay.hidden { opacity: 0; pointer-events: none; }
        .spinner { width: 50px; height: 50px; border: 4px solid rgba(212, 175, 55, 0.3); border-top: 4px solid var(--gold); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <header>
        <div class="brand" onclick="handleSecretAdminLogin()">
            <h1>Amr Osman</h1>
            <p>AR Smart Showroom</p>
        </div>
        <div class="header-actions">
            <button id="adminToggleBtn" class="btn-outline" onclick="toggleAdminPanel()"><i class="fa-solid fa-gear"></i> الإدارة</button>
            <button id="logoutBtn" class="btn-outline btn-danger" onclick="adminLogout()"><i class="fa-solid fa-sign-out-alt"></i></button>
            
            <a href="index.html" class="btn-outline" title="نظام التسعير"><i class="fa-solid fa-file-invoice"></i></a>
        </div>
    </header>

    <div class="admin-panel" id="adminPanel">
        <h3>➕ إضافة تصميم جديد للمكتبة (يظهر على هذا الجهاز فقط)</h3>
        <div class="input-group">
            <input type="text" id="newTitle" placeholder="اسم التصميم (مثال: مطبخ HPL)">
            <input type="text" id="newDesc" placeholder="وصف قصير للعميل">
        </div>
        <div class="input-group">
            <input type="text" id="newGlbUrl" placeholder="رابط ملف الـ .glb (من جيت هب)">
            <input type="text" id="newImgUrl" placeholder="رابط صورة الغلاف (اختياري)">
            <button class="add-btn" onclick="addNewModel()">حفظ في المكتبة</button>
        </div>
    </div>

    <div class="viewer-container">
        <div class="live-details">
            <h2 id="modelTitle">جاري التحميل...</h2>
            <p id="modelDesc"></p>
        </div>

        <model-viewer 
            id="main-viewer"
            src="" 
            alt="تصميم 3D"
            ar 
            ar-modes="webxr scene-viewer quick-look" 
            ar-scale="auto" 
            ar-placement="floor"
            camera-controls 
            auto-rotate 
            shadow-intensity="1.2"
            exposure="1.1">
        </model-viewer>

        <button class="force-ar-btn" onclick="forceOpenAR()">
            <i class="fa-solid fa-camera"></i> افتح الكاميرا لمعاينة المنتج
        </button>
